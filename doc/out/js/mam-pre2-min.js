!function(){var e,i,n,d,o;o="undefined"!=typeof exports&&null!==exports?exports:this,e=function(e,i,n){var d,o,t,r,a,s,g;for(++e.pending,t="<audio>","string"==typeof n&&(n=[n]),s=0,g=n.length;g>s;s++){if(a=n[s],r="",o=a.substr(-4),".mp3"===o||".mpg"===o)r="audio/mpeg";else if(".ogg"===o)r="audio/ogg";else{if(".wav"!==o){console.log("Unknown audio type for "+a);continue}r="audio/wav"}t+='<source src="'+a+'" type="'+r+'">'}return t+="</audio>",d=$(t),d.on("loadeddata",function(){var n;return n=this,e.dfd.notify(n),e.media.audio[i]=n,0===--e.pending?e.dfd.resolve(e.media):void 0}),$("body").append(d)},i=function(e,i){var n,d,t,r,a;for(d=[],r=0,a=i.length;a>r;r++)n=i[r],d.push(n.replace(/\s/g,"+"));return++e.pending,o.WebFontConfig={google:{families:d},active:function(){var n,d,o;for(d=0,o=i.length;o>d;d++)n=i[d],e.media.fonts.push(e.pjs.createFont(n));return 0===--e.pending?e.dfd.resolve(e.media):void 0}},t="//ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",$.getScript(t)},n=function(e,i,n){var d;return++e.pending,++e.pendingImg,d=$('<img src="'+n+'"/>'),d.on("load",function(){var n;return n=e.pjs.createImage(d.width(),d.height(),e.pjs.ARGB),n.sourceImg.getContext("2d").drawImage(d[0],0,0),e.media.images[i]=n,e.imgs[i]=d[0],e.dfd.notify(n),0===--e.pendingImg&&e.dfdImg.resolve(),0===--e.pending?e.dfd.resolve(e.media):void 0}),$("body").append(d)},d=function(e,i,n){var d;return null==e.dfdImg?(e.dfd.reject("No images specified"),void 0):(++e.pending,d=function(){return e.dfdImg.done(function(){var d,o,t,r,a,s,g;if(null==e.media.images[n.sheet])return e.dfd.reject("No image named "+n.sheet),void 0;if(r=e.imgs[n.sheet],null!=n.frames){for(d=[],o=s=0,g=n.frames;g>=0?g>s:s>g;o=g>=0?++s:--s)a=n.x+n.width*o,t=e.pjs.createImage(n.width,n.height,e.pjs.ARGB),t.sourceImg.getContext("2d").drawImage(r,a,n.y,n.width,n.height,0,0,n.width,n.height),d.push(t);e.media.sprites[i]=d}else t=e.pjs.createImage(n.width,n.height,e.pjs.ARGB),t.sourceImg.getContext("2d").drawImage(r,n.x,n.y,n.width,n.height,0,0,n.width,n.height),e.media.sprites[i]=t;return e.dfd.notify(e.media.sprites[i]),0===--e.pending?e.dfd.resolve(e.media):void 0})},setTimeout(d,0))},o.MAM=function(o,t){var r,a,s,g,f,u,m,l;if(r={dfd:$.Deferred(),media:{},pending:0,pjs:t},null!=o.images){r.media.images={},r.imgs={},r.pendingImg=0,r.dfdImg=$.Deferred(),u=o.images;for(a in u)g=u[a],n(r,a,g)}if(null!=o.sprites){r.media.sprites={},m=o.sprites;for(a in m)s=m[a],d(r,a,s)}if(null!=o.fonts&&(r.media.fonts=[],i(r,o.fonts)),null!=o.audio){r.media.audio={},l=o.audio;for(a in l)f=l[a],e(r,a,f)}return r.dfd.promise()},o.MAM2=function(e,i,n,d){return e.fail(function(e){return console.log("Loading of assets failed: "+e)}),e.done(function(e){return console.log("Loading of assets done"),null!=i&&i(e),null!=n?d.draw=n:void 0})}}.call(this);